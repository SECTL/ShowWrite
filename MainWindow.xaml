<Window x:Class="ShowWrite.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
        xmlns:sys="clr-namespace:System.Windows;assembly=PresentationFramework"
        Title="ShowWrite视频展台" WindowState="Maximized" Background="Transparent" WindowStyle="None" AllowsTransparency="True"
        xmlns:local="clr-namespace:ShowWrite"
        xmlns:services="clr-namespace:ShowWrite.Services"
        MouseWheel="Window_MouseWheel" Width="1558">

    <Window.Resources>
        <!-- 使用一个 ResourceDictionary 包装所有资源 -->
        <ResourceDictionary>
            <!-- 导入深色主题资源字典（默认） -->
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="themes/DarkTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- 画笔设置按钮样式 -->
            <Style TargetType="Button" x:Key="PenSettingsButtonStyle">
                <Setter Property="Width" Value="36"/>
                <Setter Property="Height" Value="36"/>
                <Setter Property="Margin" Value="1"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="BorderBrush" Value="#555"/>
                <Setter Property="Padding" Value="0"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="2">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 对钩图标几何数据 -->
            <Geometry x:Key="CheckIconGeometry">M46 14L25 35.6l-7-7.2l-7 7.2L25 50l28-28.8z</Geometry>

            <!-- 对钩图标样式 -->
            <Style x:Key="CheckIconStyle" TargetType="Path">
                <Setter Property="Data" Value="{StaticResource CheckIconGeometry}"/>
                <Setter Property="Stretch" Value="Uniform"/>
                <Setter Property="Width" Value="20"/>
                <Setter Property="Height" Value="20"/>
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="Fill" Value="#FFFFFF"/>
                <Setter Property="Visibility" Value="Collapsed"/>
            </Style>

            <!-- 颜色按钮容器样式 -->
            <Style x:Key="ColorButtonContainerStyle" TargetType="Grid">
                <Setter Property="Width" Value="28"/>
                <Setter Property="Height" Value="28"/>
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
            </Style>

            <!-- 颜色方块样式 -->
            <Style x:Key="ColorRectangleStyle" TargetType="Rectangle">
                <Setter Property="Width" Value="28"/>
                <Setter Property="Height" Value="28"/>
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="RadiusX" Value="3"/>
                <Setter Property="RadiusY" Value="3"/>
                <Setter Property="Stroke" Value="#666"/>
                <Setter Property="StrokeThickness" Value="1"/>
            </Style>

            <!-- 照片选择状态提示转换器 -->
            <local:PhotoSelectedTipConverter x:Key="PhotoSelectedTipConverter"/>

            <!-- 减法转换器 -->
            <services:SubtractConverter x:Key="SubtractConverter"/>

            <!-- 字符串到可见性转换器 -->
            <services:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>

            <!-- 橡皮擦图像源 -->
            <DrawingImage x:Key="EllipseEraserImageSource">
                <DrawingImage.Drawing>
                    <GeometryDrawing Brush="#80FFFFFF">
                        <GeometryDrawing.Geometry>
                            <EllipseGeometry Center="19,28" RadiusX="19" RadiusY="28"/>
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                </DrawingImage.Drawing>
            </DrawingImage>

            <DrawingImage x:Key="RectangleEraserImageSource">
                <DrawingImage.Drawing>
                    <GeometryDrawing Brush="#80FFFFFF">
                        <GeometryDrawing.Geometry>
                            <RectangleGeometry Rect="0,0,38,56" RadiusX="4" RadiusY="4"/>
                        </GeometryDrawing.Geometry>
                    </GeometryDrawing>
                </DrawingImage.Drawing>
            </DrawingImage>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <!-- 底部工具栏已移至 VideoAreaContainer 内部，因此移除第二行 -->
        </Grid.RowDefinitions>

        <!-- 视频区域容器 - 包含可缩放的VideoArea和不可缩放的OverlayInkCanvas，以及悬浮工具栏 -->
        <Grid x:Name="VideoAreaContainer" Grid.Row="0" ClipToBounds="True" Background="{DynamicResource WindowBackgroundBrush}">
            <!-- 视频区域 - 使用正确的变换定义 -->
            <Grid x:Name="VideoArea"
                  IsManipulationEnabled="True"
                  ManipulationStarting="VideoArea_ManipulationStarting"
                  ManipulationDelta="VideoArea_ManipulationDelta"
                  MouseDown="VideoArea_MouseDown"
                  MouseMove="VideoArea_MouseMove"
                  MouseUp="VideoArea_MouseUp"
                  MouseLeftButtonDown="VideoArea_MouseLeftButtonDown">
                <!-- 添加 RenderTransform 定义 -->
                <Grid.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform x:Name="ZoomTransform" ScaleX="1" ScaleY="1" />
                        <TranslateTransform x:Name="PanTransform" X="0" Y="0" />
                    </TransformGroup>
                </Grid.RenderTransform>
                <Image x:Name="VideoImage" Stretch="Uniform" />
                <InkCanvas x:Name="Ink" Background="Transparent" 
                           PreviewMouseLeftButtonDown="Ink_PreviewMouseLeftButtonDown"
                           PreviewMouseMove="Ink_PreviewMouseMove"
                           PreviewMouseLeftButtonUp="Ink_PreviewMouseLeftButtonUp" />
                
                <!-- 橡皮擦覆盖层 -->
                <Canvas x:Name="EraserOverlayCanvas" Background="Transparent" IsHitTestVisible="False" Visibility="Collapsed">
                    <Image x:Name="EraserFeedback" Width="38" Height="56" Stretch="Fill">
                        <Image.RenderTransform>
                            <TranslateTransform x:Name="EraserFeedbackTranslateTransform" X="0" Y="0"/>
                        </Image.RenderTransform>
                    </Image>
                </Canvas>
            </Grid>
            
            <!-- 画笔模式专用透明图层 - 不随任何缩放而缩放 -->
            <InkCanvas x:Name="OverlayInkCanvas" 
                       Background="Transparent" 
                       Visibility="Collapsed"
                       PreviewMouseLeftButtonDown="OverlayInk_PreviewMouseLeftButtonDown"
                       PreviewMouseMove="OverlayInk_PreviewMouseMove"
                       PreviewMouseLeftButtonUp="OverlayInk_PreviewMouseLeftButtonUp"
                       PreviewStylusDown="OverlayInk_PreviewStylusDown"
                       PreviewStylusMove="OverlayInk_PreviewStylusMove"
                       PreviewStylusUp="OverlayInk_PreviewStylusUp" />

            <!-- 底部工具栏 - 悬浮在视频区域上方 -->
            <Grid x:Name="BottomToolbar" 
                  VerticalAlignment="Bottom"
                  Height="70"
                  Margin="0,0,0,5"
                  Background="{DynamicResource ToolbarBackgroundBrush}"
                  Panel.ZIndex="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 左侧功能区（更多/最小化/扫一扫） -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="10,0" VerticalAlignment="Center">
                    <Button x:Name="MoreButton" Style="{DynamicResource MoreButtonStyle}" Margin="5,0,5,0"
                            Click="MoreButton_Click">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path Fill="{DynamicResource IconBrush}" Data="M4 6a1 1 0 0 1 1-1h14a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1m0 12a1 1 0 0 1 1-1h14a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1m1-7a1 1 0 1 0 0 2h8a1 1 0 1 0 0-2z"/>
                            </Viewbox>
                            <TextBlock x:Name="MoreButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[More]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{DynamicResource ButtonStyle}" Click="Minimize_Click" Margin="5,0">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="29" Height="30">
                                <Path Fill="{DynamicResource IconBrush}" Data="M18 3.25H6A2.75 2.75 0 0 0 3.25 6v6a.75.75 0 0 0 1.5 0V6A1.25 1.25 0 0 1 6 4.75h12A1.25 1.25 0 0 1 19.25 6v12A1.25 1.25 0 0 1 18 19.25h-6a.75.75 0 0 0 0 1.5h6A2.75 2.75 0 0 0 20.75 18V6A2.75 2.75 0 0 0 18 3.25 M11.21 13.19a.8.8 0 0 0 .29.06h4a.75.75 0 0 0 0-1.5h-2.19l3.22-3.22a.75.75 0 0 0-1.06-1.06l-3.22 3.22V8.5a.75.75 0 0 0-1.5 0v4a.8.8 0 0 0 .06.29a.7.7 0 0 0 .4.4 M8 14.25H5A1.76 1.76 0 0 0 3.25 16v3A1.76 1.76 0 0 0 5 20.75h3A1.76 1.76 0 0 0 9.75 19v-3A1.76 1.76 0 0 0 8 14.25 M8.25 19a.25.25 0 0 1-.25.25H5a.25.25 0 0 1-.25-.25v-3a.25.25 0 0 1 .25-.25h3a.25.25 0 0 1 .25.25Z"/>
                            </Viewbox>
                            <TextBlock x:Name="MinimizeButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Minimize]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{DynamicResource ButtonStyle}" Click="ScanQRCode_Click" Margin="5,0">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path Fill="{DynamicResource IconBrush}" Data="M9 3H3v6h2V5h4zM3 21v-6h2v4h4v2zM15 3v2h4v4h2V3zm4 12h2v6h-6v-2h4zM7 7h4v4H7zm0 6h4v4H7zm10-6h-4v4h4zm-4 6h4v4h-4z"/>
                            </Viewbox>
                            <TextBlock x:Name="ScanQRButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[ScanQR]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- 中间主菜单 - 居中显示 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <!-- 移动 / 画笔 / 橡皮擦 -->
                    <ToggleButton x:Name="MoveBtn" Click="MoveBtn_Click" IsChecked="True" Margin="5,0,-3,0" Style="{DynamicResource ToolToggleButtonStyle}">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path x:Name="MoveIcon">
                                    <Path.Style>
                                        <Style TargetType="Path">
                                            <Setter Property="Fill" Value="{DynamicResource IconBrush}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsChecked, RelativeSource={RelativeSource AncestorType=ToggleButton}}" Value="True">
                                                    <Setter Property="Fill" Value="White"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Path.Style>
                                    <Path.Data>M302.189 329.126H196.105l55.831 135.993c3.889 9.428-.555 19.999-9.444 23.999l-49.165 21.427c-9.165 4-19.443-.571-23.332-9.714l-53.053-129.136l-86.664 89.138C18.729 472.71 0 463.554 0 447.977V18.299C0 1.899 19.921-6.096 30.277 5.443l284.412 292.542c11.472 11.179 3.007 31.141-12.5 31.141</Path.Data>
                                </Path>
                            </Viewbox>
                            <TextBlock x:Name="MoveButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Move]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </ToggleButton>
                    <ToggleButton x:Name="PenBtn" Click="PenBtn_Click" Margin="5,0,-3,0" Style="{DynamicResource ToolToggleButtonStyle}">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path x:Name="PenIcon">
                                    <Path.Style>
                                        <Style TargetType="Path">
                                            <Setter Property="Fill" Value="{DynamicResource IconBrush}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsChecked, RelativeSource={RelativeSource AncestorType=ToggleButton}}" Value="True">
                                                    <Setter Property="Fill" Value="White"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Path.Style>
                                    <Path.Data>M4.2 20.975q-.525.125-.913-.262t-.262-.913l.875-4.25l4.55 4.55zm5.875-2.1l-4.95-4.95L15.45 3.6q.575-.575 1.425-.575T18.3 3.6l2.1 2.1q.575.575.575 1.425T20.4 8.55z</Path.Data>
                                </Path>
                            </Viewbox>
                            <TextBlock x:Name="PenButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Pen]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </ToggleButton>
                    <ToggleButton x:Name="EraserBtn" Click="EraserBtn_Click" Margin="5,0" Style="{DynamicResource ToolToggleButtonStyle}">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path x:Name="EraserIcon">
                                    <Path.Style>
                                        <Style TargetType="Path">
                                            <Setter Property="Fill" Value="{DynamicResource IconBrush}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsChecked, RelativeSource={RelativeSource AncestorType=ToggleButton}}" Value="True">
                                                    <Setter Property="Fill" Value="White"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Path.Style>
                                    <Path.Data>M3.121 17.85a3 3 0 0 1 0-4.243l7.071-7.072l8.486 8.486l-3.243 3.242H20a1 1 0 1 1 0 2H6.778a3 3 0 0 1-2.121-.878L3.12 17.849zm16.97-4.243l1.415-1.415a3 3 0 0 0 0-4.242l-4.243-4.243a3 3 0 0 0-4.242 0l-1.414 1.414z</Path.Data>
                                </Path>
                            </Viewbox>
                            <TextBlock x:Name="EraserButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Eraser]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </ToggleButton>

                    <!-- 形状按钮 -->
                    <ToggleButton x:Name="ShapeBtn" Click="ShapeBtn_Click" Margin="5,0" Style="{DynamicResource ToolToggleButtonStyle}">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path Fill="{DynamicResource IconBrush}" Data="M3 3h6v6H3V3zm8 0h6v6h-6V3zm8 0h6v6h-6V3zM3 11h6v6H3v-6zm8 0h6v6h-6v-6zm8 0h6v6h-6v-6zM3 19h6v6H3v-6zm8 0h6v6h-6v-6zm8 0h6v6h-6v-6z"/>
                            </Viewbox>
                            <TextBlock x:Name="ShapeButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Shape]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </ToggleButton>

                    <!-- 撤回 / 清屏 -->
                    <Button Style="{DynamicResource ButtonStyle}" Click="UndoInk_Click" Margin="20,0,-3,0">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path Fill="{DynamicResource IconBrush}" Data="M16 3C12 3 8.4 4.8 6 7.7V4H4v8h8v-2H6.8c2-3 5.3-5 9.2-5c6.1 0 11 4.9 11 11s-4.9 11-11 11S5 22.1 5 16H3c0 7.2 5.8 13 13 13s13-5.8 13-13S23.2 3 16 3"/>
                            </Viewbox>
                            <TextBlock x:Name="UndoButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Undo]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{DynamicResource ButtonStyle}" Click="RedoInk_Click" Margin="5,0,-3,0">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path Fill="{DynamicResource IconBrush}" Data="M16 3C8.832 3 3 8.832 3 16s5.832 13 13 13s13-5.832 13-13h-2c0 6.086-4.914 11-11 11S5 22.086 5 16S9.914 5 16 5c3.875 0 7.262 1.984 9.219 5H20v2h8V4h-2v3.719C23.617 4.844 20.02 3 16 3"/>
                            </Viewbox>
                            <TextBlock x:Name="RedoButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Redo]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{DynamicResource ButtonStyle}" Click="ClearInk_Click" Margin="5,0">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path Fill="{DynamicResource IconBrush}" Data="M16.5 4.478v.227a49 49 0 0 1 3.878.512a.75.75 0 1 1-.256 1.478l-.209-.035l-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A49 49 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a53 53 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951m-6.136-1.452a51 51 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a50 50 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452m-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058z"/>
                            </Viewbox>
                            <TextBlock x:Name="ClearButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Clear]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </Button>

                    <!-- 拍照 / 扫描 -->
                    <Button Style="{DynamicResource ButtonStyle}" Click="Capture_Click" Margin="5,0,-3,0">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path Fill="{DynamicResource IconBrush}" Data="M19 6.5h-1.28l-.32-1a3 3 0 0 0-2.84-2H9.44A3 3 0 0 0 6.6 5.55l-.32 1H5a3 3 0 0 0-3 3v8a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-8a3 3 0 0 0-3-3.05m1 11a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-8a1 1 0 0 1 1-1h2a1 1 0 0 0 1-.68l.54-1.64a1 1 0 0 1 .95-.68h5.12a1 1 0 0 1 .95.68l.54 1.64a1 1 0 0 0 .9.68h2a1 1 0 0 1 1 1Zm-8-9a4 4 0 1 0 4 4a4 4 0 0 0-4-4m0 6a2 2 0 1 1 2-2a2 2 0 0 1-2 2"/>
                            </Viewbox>
                            <TextBlock x:Name="CaptureButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Capture]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{DynamicResource ButtonStyle}" Click="ScanDocument_Click" Margin="5,0">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path Fill="{DynamicResource IconBrush}" Data="M13 9h5l-5-5zM4 22v-5h16v5zm-3-7v-2h22v2zm3-4V2h10l6 6v3z"/>
                            </Viewbox>
                            <TextBlock Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Scan]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- 右侧功能区 -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="10,0">
                    <!-- 照片按钮 - 展开/收起照片栏 -->
                    <Button x:Name="TogglePhotoBtn" 
                            Style="{DynamicResource ButtonStyle}" 
                            Click="TogglePhotoPanel_Click"
                            Margin="0,0,5,0">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path Fill="{DynamicResource IconBrush}" Data="M19 4H5a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3M5 18a1 1 0 0 1-1-1v-2.42l3.3-3.29a1 1 0 0 1 1.4 0L15.41 18Zm15-1a1 1 0 0 1-1 1h-.77l-3.81-3.83l.88-.88a1 1 0 0 1 1.4 0l3.3 3.29Zm0-3.24l-1.88-1.87a3.06 3.06 0 0 0-4.24 0l-.88.88l-2.88-2.88a3.06 3.06 0 0 0-4.24 0L4 11.76V7a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1Z"/>
                            </Viewbox>
                            <TextBlock x:Name="TogglePhotoButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Photos]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- 连接设备按钮 -->
                    <Button x:Name="ConnectDeviceBtn" 
                            Style="{DynamicResource ButtonStyle}" 
                            Click="ConnectDeviceBtn_Click">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Viewbox Width="30" Height="30">
                                <Path Fill="{DynamicResource IconBrush}" Data="M640 384v64H448a128 128 0 0 0-128 128v128a128 128 0 0 0 128 128h320a128 128 0 0 0 128-128V576a128 128 0 0 0-64-110.848V394.88c74.56 26.368 128 97.472 128 181.056v128a192 192 0 0 1-192 192H448a192 192 0 0 1-192-192V576a192 192 0 0 1 192-192zM384 640v-64h192a128 128 0 0 0 128-128V320a128 128 0 0 0-128-128H256a128 128 0 0 0-128 128v128a128 128 0 0 0 64 110.848v70.272A192.06 192.06 0 0 1 64 448V320a192 192 0 0 1 192-192h320a192 192 0 0 1 192 192v128a192 192 0 0 1-192 192z"/>
                            </Viewbox>
                            <TextBlock x:Name="ConnectDeviceButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[ConnectDevice]}" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0" Foreground="{DynamicResource TextBrush}"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>
        
        <!-- 照片折叠栏 - 覆盖在视频画面上方 -->
        <Border x:Name="PhotoPanelBorder" 
                Grid.Row="0"
                Width="400" 
                HorizontalAlignment="Right"
                Margin="0,0,0,75"
                Background="{DynamicResource PopupBackground}"
                BorderBrush="{DynamicResource PopupBorder}"
                BorderThickness="1,0,0,0"
                Visibility="Collapsed"
                Panel.ZIndex="20">
            <Grid>
                <!-- 内容保持不变（与原始文件相同） -->
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- 标题栏 -->
                <Border Grid.Row="0" Background="{DynamicResource PopupBackground}" Padding="10,8" BorderBrush="{DynamicResource PopupBorder}" BorderThickness="0,0,0,1">
                    <Grid>
                        <TextBlock x:Name="PhotoRecordsTitleText" 
                                   Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[PhotoRecords]}" 
                                   Foreground="{DynamicResource TextBrush}" 
                                   FontSize="16" 
                                   FontWeight="Bold"
                                   HorizontalAlignment="Left"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button x:Name="SaveSelectedBtn" 
                                    Style="{DynamicResource MenuButtonStyle}"
                                    Width="60" Height="30"
                                    Click="SavePhoto_Click"
                                    Visibility="Collapsed">
                                <TextBlock x:Name="SaveSelectedButtonText" 
                                           Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[OK]}"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextBrush}"/>
                            </Button>
                            <Button x:Name="CancelSelectBtn" 
                                    Style="{DynamicResource MenuButtonStyle}"
                                    Width="60" Height="30"
                                    Click="CancelSelect_Click"
                                    Visibility="Collapsed"
                                    Margin="5,0,0,0">
                                <TextBlock Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Cancel]}"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextBrush}"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- 照片列表 -->
                <ListBox x:Name="PhotoList" 
                         Grid.Row="1"
                         Background="Transparent"
                         BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         Tag="Collapsed">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="8,6" 
                                    Background="{DynamicResource PopupBackground}" 
                                    CornerRadius="6" 
                                    BorderBrush="{DynamicResource PopupBorder}" 
                                    BorderThickness="1">
                                <Grid>
                                    <DockPanel LastChildFill="True">
                                        <!-- 左侧编号 -->
                                        <TextBlock Text="{Binding Index}" 
                                                   DockPanel.Dock="Left"
                                                   Width="30"
                                                   TextAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Foreground="{DynamicResource TextBrush}"
                                                   FontSize="14"
                                                   FontWeight="Bold"/>
                                        <!-- 缩略图 -->
                                        <Image Source="{Binding Image}" 
                                               Width="310" 
                                               Height="220" 
                                               Stretch="UniformToFill" 
                                               Margin="0,8,8,8"
                                               RenderOptions.BitmapScalingMode="HighQuality"
                                               MouseLeftButtonDown="PhotoImage_MouseLeftButtonDown"/>
                                        <!-- 复选框 -->
                                        <CheckBox x:Name="PhotoCheckBox" 
                                                  IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                  DockPanel.Dock="Right"
                                                  VerticalAlignment="Top" 
                                                  Margin="0,8,8,0"
                                                  Width="24" Height="24"
                                                  Visibility="{Binding RelativeSource={RelativeSource AncestorType=ListBox}, Path=Tag, Converter={StaticResource StringToVisibilityConverter}}"/>
                                    </DockPanel>
                                    <!-- 左下角删除按钮 -->
                                    <Button Width="28" Height="28"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Bottom"
                                            Margin="35,0,0,8"
                                            Click="DeletePhoto_Click"
                                            Tag="{Binding}"
                                            Cursor="Hand"
                                            ToolTip="删除照片">
                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="#80808080" CornerRadius="4" Width="28" Height="28">
                                                    <Viewbox Width="16" Height="16">
                                                        <Path Fill="White" Data="M5.75 3V1.5h4.5V3zm-1.5 0V1a1 1 0 0 1 1-1h5.5a1 1 0 0 1 1 1v2h2.5a.75.75 0 0 1 0 1.5h-.365l-.743 9.653A2 2 0 0 1 11.148 16H4.852a2 2 0 0 1-1.994-1.847L2.115 4.5H1.75a.75.75 0 0 1 0-1.5zm-.63 1.5h8.76l-.734 9.538a.5.5 0 0 1-.498.462H4.852a.5.5 0 0 1-.498-.462z"/>
                                                    </Viewbox>
                                                </Border>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                
                <!-- 底部按钮栏 -->
                <Border Grid.Row="2" Background="{DynamicResource PopupBackground}" Padding="10,8" BorderBrush="{DynamicResource PopupBorder}" BorderThickness="0,1,0,0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button x:Name="SavePhotoBtn" 
                                Style="{DynamicResource MenuButtonStyle}" 
                                Width="80" Height="40" 
                                Click="SavePhoto_Click">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Viewbox Width="18" Height="18" Margin="0,0,5,0">
                                    <Path Fill="{DynamicResource IconBrush}" Data="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-9 14l-5-5 1.41-1.41L8 14.17l7.59-7.59L17 8l-9 9z"/>
                                </Viewbox>
                                <TextBlock x:Name="SavePhotoButtonText" 
                                           Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[SaveImage]}" 
                                           FontSize="12" 
                                           Foreground="{DynamicResource TextBrush}"/>
                            </StackPanel>
                        </Button>
                        
                        <Button x:Name="ImportPhotoBtn" 
                                Style="{DynamicResource MenuButtonStyle}" 
                                Width="80" Height="40" 
                                Click="ImportPhoto_Click"
                                Margin="10,0,0,0">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Viewbox Width="18" Height="18" Margin="0,0,5,0">
                                    <Path Fill="{DynamicResource IconBrush}" Data="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                                </Viewbox>
                                <TextBlock x:Name="ImportPhotoButtonText" 
                                           Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Import]}" 
                                           FontSize="12" 
                                           Foreground="{DynamicResource TextBrush}"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- 连接设备悬浮窗 -->
        <Popup x:Name="ConnectDevicePopup" PlacementTarget="{Binding ElementName=ConnectDeviceBtn}" Placement="Top" StaysOpen="True"
               AllowsTransparency="True" PopupAnimation="Fade" Opened="ConnectDevicePopup_Opened" Closed="ConnectDevicePopup_Closed">
            <!-- 内容保持不变（省略，与原始文件相同） -->
            <Border Width="300" Background="{DynamicResource PopupBackground}" CornerRadius="6" BorderBrush="{DynamicResource PopupBorder}" BorderThickness="1"
                    Padding="15">
                <StackPanel>
                    <TextBlock x:Name="ConnectDeviceTitleText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[ConnectDevice]}" Foreground="{DynamicResource TextBrush}" FontSize="16" FontWeight="Bold" 
                               Margin="0,0,0,15" HorizontalAlignment="Center"/>

                    <TextBlock x:Name="ConnectionStatusText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[WaitingForConnection]}" Foreground="{DynamicResource TextBrush}" FontSize="14" 
                               Margin="0,0,0,10" HorizontalAlignment="Center"/>

                    <Border Width="200" Height="200" Background="White" Margin="0,0,0,15" HorizontalAlignment="Center">
                        <Image x:Name="QrCodeImage" Width="180" Height="180" Stretch="Uniform"/>
                    </Border>

                    <TextBlock x:Name="IpAddressText" Text="" Foreground="{DynamicResource TextBrush}" FontSize="12"
                               Margin="0,0,0,15" HorizontalAlignment="Center"/>

                    <TextBlock x:Name="PortNumberLabelText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[PortNumber]}" Foreground="{DynamicResource TextBrush}" FontSize="12"
                               Margin="0,0,0,5" HorizontalAlignment="Center"/>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
                        <TextBox x:Name="PortNumberText" Text="8888" Width="100" Height="30" FontSize="12" 
                                 TextAlignment="Center" VerticalContentAlignment="Center"/>
                        <Button Style="{DynamicResource ButtonStyle}" Width="60" Height="30" Margin="5,0,0,0" Click="RefreshPortBtn_Click">
                            <TextBlock x:Name="RefreshButtonText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Refresh]}" FontSize="10" HorizontalAlignment="Center" Foreground="{DynamicResource TextBrush}"/>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Popup>

        <!-- 画笔设置悬浮窗 -->
        <Popup x:Name="PenSettingsPopup" PlacementTarget="{Binding ElementName=PenBtn}" Placement="Top" StaysOpen="True"
               AllowsTransparency="True" PopupAnimation="Fade" Opened="PenSettingsPopup_Opened" Closed="PenSettingsPopup_Closed">
            <!-- 内容保持不变（省略，与原始文件相同） -->
            <Border Width="220" Background="{DynamicResource PopupBackground}" CornerRadius="6" BorderBrush="{DynamicResource PopupBorder}" BorderThickness="1"
                    Padding="8">
                <StackPanel>
                    <!-- 标题栏 -->
                    <Grid Margin="0,0,0,10">
                        <TextBlock x:Name="PenSettingsTitleText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[PenSettings]}" 
                                   Foreground="{DynamicResource TextBrush}" FontSize="14" FontWeight="Bold" 
                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        <Button x:Name="PenSettingsCloseBtn" Click="ClosePenSettings_Click" 
                                Width="20" Height="20" HorizontalAlignment="Right" VerticalAlignment="Center"
                                Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="Transparent" Width="20" Height="20">
                                        <Viewbox Width="20" Height="20">
                                            <Path Fill="{DynamicResource TextBrush}" Data="M16 2C8.2 2 2 8.2 2 16s6.2 14 14 14s14-6.2 14-14S23.8 2 16 2m5.4 21L16 17.6L10.6 23L9 21.4l5.4-5.4L9 10.6L10.6 9l5.4 5.4L21.4 9l1.6 1.6l-5.4 5.4l5.4 5.4z"/>
                                        </Viewbox>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>

                    <!-- 笔宽设置 -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[PenWidthLabel]}" Foreground="{DynamicResource TextBrush}" VerticalAlignment="Center" Width="40"/>
                        <Slider x:Name="PenWidthSlider" Minimum="1" Maximum="20" Value="2" Width="120"
                                ValueChanged="PenWidthSlider_ValueChanged"/>
                        <TextBlock x:Name="PenWidthValue" Text="2" Foreground="{DynamicResource TextBrush}" VerticalAlignment="Center" 
                                   Margin="10,0,0,0" Width="20"/>
                    </StackPanel>

                    <!-- 颜色选择 -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- 第一行颜色 -->
                        <Button Grid.Row="0" Grid.Column="0" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Black" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Black]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Black"/>
                                <Path x:Name="CheckIcon_Black" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="0" Grid.Column="1" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Red" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Red]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Red"/>
                                <Path x:Name="CheckIcon_Red" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="0" Grid.Column="2" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Green" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Green]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Green"/>
                                <Path x:Name="CheckIcon_Green" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="0" Grid.Column="3" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Blue" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Blue]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Blue"/>
                                <Path x:Name="CheckIcon_Blue" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="0" Grid.Column="4" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Yellow" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Yellow]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Yellow"/>
                                <Path x:Name="CheckIcon_Yellow" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>

                        <!-- 第二行颜色 -->
                        <Button Grid.Row="1" Grid.Column="0" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="White" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[White]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="White"/>
                                <Path x:Name="CheckIcon_White" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="1" Grid.Column="1" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Orange" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Orange]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Orange"/>
                                <Path x:Name="CheckIcon_Orange" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="1" Grid.Column="2" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Purple" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Purple]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Purple"/>
                                <Path x:Name="CheckIcon_Purple" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="1" Grid.Column="3" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Cyan" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Cyan]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Cyan"/>
                                <Path x:Name="CheckIcon_Cyan" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="1" Grid.Column="4" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Magenta" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Magenta]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Magenta"/>
                                <Path x:Name="CheckIcon_Magenta" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>

                        <!-- 第三行颜色 -->
                        <Button Grid.Row="2" Grid.Column="0" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Brown" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Brown]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Brown"/>
                                <Path x:Name="CheckIcon_Brown" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="2" Grid.Column="1" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Pink" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Pink]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Pink"/>
                                <Path x:Name="CheckIcon_Pink" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="2" Grid.Column="2" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Gray" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Gray]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Gray"/>
                                <Path x:Name="CheckIcon_Gray" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="2" Grid.Column="3" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="DarkRed" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[DarkRed]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="DarkRed"/>
                                <Path x:Name="CheckIcon_DarkRed" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="2" Grid.Column="4" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="DarkGreen" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[DarkGreen]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="DarkGreen"/>
                                <Path x:Name="CheckIcon_DarkGreen" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>

                        <!-- 第四行颜色 -->
                        <Button Grid.Row="3" Grid.Column="0" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="DarkBlue" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[DarkBlue]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="DarkBlue"/>
                                <Path x:Name="CheckIcon_DarkBlue" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="3" Grid.Column="1" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Gold" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Gold]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Gold"/>
                                <Path x:Name="CheckIcon_Gold" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="3" Grid.Column="2" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Silver" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Silver]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Silver"/>
                                <Path x:Name="CheckIcon_Silver" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="3" Grid.Column="3" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Lime" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Lime]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Lime"/>
                                <Path x:Name="CheckIcon_Lime" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                        <Button Grid.Row="3" Grid.Column="4" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ColorButton_Click" Tag="Teal" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Teal]}">
                            <Grid Style="{StaticResource ColorButtonContainerStyle}">
                                <Rectangle Style="{StaticResource ColorRectangleStyle}" Fill="Teal"/>
                                <Path x:Name="CheckIcon_Teal" Style="{StaticResource CheckIconStyle}"/>
                            </Grid>
                        </Button>
                    </Grid>
                </StackPanel>
            </Border>
        </Popup>

        <!-- 清屏确认悬浮窗 -->
        <Popup x:Name="ClearConfirmPopup" PlacementTarget="{Binding ElementName=EraserBtn}" Placement="Custom" StaysOpen="False"
               AllowsTransparency="True" PopupAnimation="Fade" Opened="ClearConfirmPopup_Opened" Closed="ClearConfirmPopup_Closed"
               CustomPopupPlacementCallback="ClearConfirmPopup_PlacementCallback">
            <!-- 内容保持不变（省略，与原始文件相同） -->
            <Border Width="280" Background="{DynamicResource PopupBackground}" CornerRadius="8" BorderBrush="{DynamicResource PopupBorder}" BorderThickness="1"
                    Padding="15">
                <StackPanel>
                    <TextBlock Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[ClearScreenConfirm]}" 
                               Foreground="{DynamicResource TextBrush}" FontSize="14" FontWeight="Bold" 
                               HorizontalAlignment="Center" Margin="0,0,0,15"/>
                    <TextBlock Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[SlideToConfirm]}" 
                               Foreground="{DynamicResource TextBrush}" FontSize="11" Opacity="0.7"
                               HorizontalAlignment="Center" Margin="0,0,0,10"/>
                    <Grid Height="40">
                        <Border x:Name="SliderTrack" Background="#404040" CornerRadius="20" />
                        <Border x:Name="SliderProgress" Background="#FF6B6B" CornerRadius="20" 
                                HorizontalAlignment="Left" Width="0"/>
                        <TextBlock x:Name="ConfirmText" Text="→" Foreground="White" FontSize="16"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   IsHitTestVisible="False"/>
                        <Border x:Name="SliderThumb" Background="#FF4444" CornerRadius="18" 
                                Width="36" Height="36" HorizontalAlignment="Left" Margin="2,0,0,0"
                                Cursor="Hand" MouseLeftButtonDown="SliderThumb_MouseLeftButtonDown"
                                MouseMove="SliderThumb_MouseMove" MouseLeftButtonUp="SliderThumb_MouseLeftButtonUp">
                            <TextBlock Text="→" Foreground="White" FontSize="14" FontWeight="Bold"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       IsHitTestVisible="False"/>
                        </Border>
                    </Grid>
                </StackPanel>
            </Border>
        </Popup>

        <!-- 形状设置弹出窗口 -->
        <Popup x:Name="ShapeSettingsPopup" PlacementTarget="{Binding ElementName=ShapeBtn}" Placement="Top" StaysOpen="False"
               AllowsTransparency="True" PopupAnimation="Fade" Opened="ShapeSettingsPopup_Opened">
            <!-- 内容保持不变（省略，与原始文件相同） -->
            <Border Width="200" Background="{DynamicResource PopupBackground}" CornerRadius="6" BorderBrush="{DynamicResource PopupBorder}" BorderThickness="1"
                    Padding="10">
                <StackPanel>
                    <!-- 标题 -->
                    <TextBlock x:Name="ShapeSelectionTitleText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[ShapeSelection]}" Foreground="{DynamicResource TextBrush}" FontSize="14" FontWeight="Bold" 
                               Margin="0,0,0,10" HorizontalAlignment="Center"/>

                    <!-- 形状按钮网格 -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- 第一行形状 -->
                        <Button Grid.Row="0" Grid.Column="0" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ShapeButton_Click" Tag="Line" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Line]}">
                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Viewbox Width="24" Height="24">
                                    <Path Fill="{DynamicResource IconBrush}" Data="M3 21h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18v-2H3v2zm0-4h18V7H3v2z"/>
                                </Viewbox>
                                <TextBlock x:Name="LineText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Line]}" FontSize="9" Foreground="{DynamicResource TextBrush}" Margin="0,2,0,0"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Row="0" Grid.Column="1" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ShapeButton_Click" Tag="Arrow" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Arrow]}">
                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Viewbox Width="24" Height="24">
                                    <Path Fill="{DynamicResource IconBrush}" Data="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/>
                                </Viewbox>
                                <TextBlock x:Name="ArrowText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Arrow]}" FontSize="9" Foreground="{DynamicResource TextBrush}" Margin="0,2,0,0"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Row="0" Grid.Column="2" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ShapeButton_Click" Tag="Rectangle" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Rectangle]}">
                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Viewbox Width="24" Height="24">
                                    <Path Fill="{DynamicResource IconBrush}" Data="M3 3h18v18H3V3zm2 2v14h14V5H5z"/>
                                </Viewbox>
                                <TextBlock x:Name="RectangleText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Rectangle]}" FontSize="9" Foreground="{DynamicResource TextBrush}" Margin="0,2,0,0"/>
                            </StackPanel>
                        </Button>

                        <!-- 第二行形状 -->
                        <Button Grid.Row="1" Grid.Column="0" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ShapeButton_Click" Tag="Ellipse" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Ellipse]}">
                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Viewbox Width="24" Height="24">
                                    <Path Fill="{DynamicResource IconBrush}" Data="M12 4C7.58 4 4 7.58 4 12s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/>
                                </Viewbox>
                                <TextBlock x:Name="EllipseText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Ellipse]}" FontSize="9" Foreground="{DynamicResource TextBrush}" Margin="0,2,0,0"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Row="1" Grid.Column="1" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ShapeButton_Click" Tag="Circle" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Circle]}">
                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Viewbox Width="24" Height="24">
                                    <Path Fill="{DynamicResource IconBrush}" Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/>
                                </Viewbox>
                                <TextBlock x:Name="CircleText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Circle]}" FontSize="9" Foreground="{DynamicResource TextBrush}" Margin="0,2,0,0"/>
                            </StackPanel>
                        </Button>
                        <Button Grid.Row="1" Grid.Column="2" Style="{StaticResource PenSettingsButtonStyle}" 
                                Click="ShapeButton_Click" Tag="DashedLine" ToolTip="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[DashedLine]}">
                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Viewbox Width="24" Height="24">
                                    <Path Fill="{DynamicResource IconBrush}" Data="M3 11h2v2H3v-2zm4 0h2v2H7v-2zm4 0h2v2h-2v-2zm4 0h2v2h-2v-2zm4 0h2v2h-2v-2z"/>
                                </Viewbox>
                                <TextBlock x:Name="DashedLineText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[DashedLine]}" FontSize="9" Foreground="{DynamicResource TextBrush}" Margin="0,2,0,0"/>
                            </StackPanel>
                        </Button>
                    </Grid>

                    <!-- 关闭按钮 -->
                    <Button Click="CloseShapeSettings_Click" Margin="0,10,0,0" 
                            Background="{DynamicResource ButtonBackground}" Foreground="{DynamicResource TextBrush}" Height="30">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock x:Name="CloseShapeSettingsText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Close]}" FontSize="10" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Border>
        </Popup>

        <!-- 触控信息悬浮窗 -->
        <Popup x:Name="TouchInfoPopup" 
               Placement="Absolute" 
               AllowsTransparency="True" 
               StaysOpen="True"
               IsOpen="True"
               PopupAnimation="Fade">
            <Border Background="#CC2C3E50" 
                    CornerRadius="8" 
                    Padding="15,10"
                    BorderBrush="#34495E"
                    BorderThickness="2"
                    MinWidth="250">
                <StackPanel>
                    <TextBlock Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[TouchInfo]}" 
                               Foreground="White" 
                               FontSize="16" 
                               FontWeight="Bold"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,5"/>
                    <TextBlock x:Name="TouchCountText" 
                               Foreground="White" 
                               FontSize="14" 
                               Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[TouchPoints], StringFormat='{}{0}: 0'}"/>
                    <TextBlock x:Name="TouchAreaText" 
                               Foreground="#DDDDDD" 
                               FontSize="12"
                               Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Area], StringFormat='{}{0}: 0 像素²'}"
                               Margin="0,2,0,0"/>
                    <TextBlock x:Name="SDKTouchAreaText" 
                       Foreground="#DDDDDD" 
                       FontSize="12"
                       Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[SDKArea], StringFormat='{}{0}: 0 像素²'}"
                       Margin="0,2,0,0"/>
                    <TextBlock x:Name="TouchCenterText" 
                               Foreground="#DDDDDD" 
                               FontSize="12"
                       Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Center], StringFormat='{}{0}: (0, 0)'}"
                       Margin="0,2,0,0"/>
                    <Button Click="CloseTouchInfo_Click" 
                            Margin="0,10,0,0" 
                            Background="#34495E" 
                            Foreground="White" 
                            Height="25"
                            FontSize="12">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Close]}" FontSize="10" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Border>
        </Popup>

        <!-- 更多菜单弹出窗口 - 修改：按钮内容居中 -->
        <Popup x:Name="MoreMenuPopup" PlacementTarget="{Binding ElementName=MoreButton}" Placement="Top" StaysOpen="False"
               AllowsTransparency="True" PopupAnimation="Fade" Closed="MoreMenuPopup_Closed">
            <Border Width="150" Background="{DynamicResource PopupBackground}" CornerRadius="6" BorderBrush="{DynamicResource PopupBorder}" BorderThickness="1">
                <StackPanel HorizontalAlignment="Stretch">
                    <Button Click="SwitchCamera_Click" 
                            Background="Transparent" BorderThickness="0" Foreground="{DynamicResource TextBrush}" Height="40"
                            HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
                        <TextBlock x:Name="SwitchCameraText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[SwitchCamera]}" VerticalAlignment="Center"/>
                    </Button>
                    <Button Click="OpenAdjustVideo_Click" 
                            Background="Transparent" BorderThickness="0" Foreground="{DynamicResource TextBrush}" Height="40"
                            HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
                        <TextBlock x:Name="AdjustVideoText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[AdjustVideo]}" VerticalAlignment="Center"/>
                    </Button>
                    <Button Click="OpenPerspectiveCorrection_Click" 
                            Background="Transparent" BorderThickness="0" Foreground="{DynamicResource TextBrush}" Height="40"
                            HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
                        <TextBlock x:Name="PerspectiveCorrectionText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[PerspectiveCorrection]}" VerticalAlignment="Center"/>
                    </Button>
                    <Button Click="ClearCorrection_Click" 
                            Background="Transparent" BorderThickness="0" Foreground="{DynamicResource TextBrush}" Height="40"
                            HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
                        <TextBlock x:Name="ClearCorrectionText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[ClearCorrection]}" VerticalAlignment="Center"/>
                    </Button>
                    <Button Click="OpenSettings_Click" 
                            Background="Transparent" BorderThickness="0" Foreground="{DynamicResource TextBrush}" Height="40"
                            HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
                        <TextBlock x:Name="SettingsText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Settings]}" VerticalAlignment="Center"/>
                    </Button>
                    <Button Click="Exit_Click" 
                            Background="Transparent" BorderThickness="0" Foreground="{DynamicResource TextBrush}" Height="40"
                            HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">
                        <TextBlock x:Name="ExitText" Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Exit]}" VerticalAlignment="Center"/>
                    </Button>
                </StackPanel>
            </Border>
        </Popup>

        <!-- 梯形校正模式界面 - 移到最顶层 -->
        <Grid x:Name="PerspectiveCorrectionGrid" 
              Grid.Row="0"
              Panel.ZIndex="1000"
              Background="#CC2B2B2B"
              Visibility="Collapsed">
            <!-- 添加一个背景层来确保视频内容可见 -->
            <Grid Background="#33000000">
                <!-- 校正点容器 -->
                <Canvas x:Name="CorrectionCanvas" 
                        Background="Transparent"
                        MouseLeftButtonDown="CorrectionCanvas_MouseDown"
                        MouseMove="CorrectionCanvas_MouseMove"
                        MouseLeftButtonUp="CorrectionCanvas_MouseUp">
                    <!-- 校正四边形 -->
                    <Polygon x:Name="CorrectionPolygon" 
                             Stroke="White" 
                             StrokeThickness="2" 
                             StrokeDashArray="5,5"
                             Fill="#40FFFFFF"
                             Points="100,100 500,100 500,300 100,300"/>

                    <!-- 四个校正点 -->
                    <Ellipse x:Name="CorrectionPoint0" 
                             Canvas.Left="100" Canvas.Top="100"
                             Width="20" Height="20" 
                             Fill="Red" Cursor="Hand"/>
                    <Ellipse x:Name="CorrectionPoint1" 
                             Canvas.Left="500" Canvas.Top="100"
                             Width="20" Height="20" 
                             Fill="Red" Cursor="Hand"/>
                    <Ellipse x:Name="CorrectionPoint2" 
                             Canvas.Left="500" Canvas.Top="300"
                             Width="20" Height="20" 
                             Fill="Red" Cursor="Hand"/>
                    <Ellipse x:Name="CorrectionPoint3" 
                             Canvas.Left="100" Canvas.Top="300"
                             Width="20" Height="20" 
                             Fill="Red" Cursor="Hand"/>

                    <!-- 点标签 -->
                    <TextBlock x:Name="CorrectionLabel0" 
                               Canvas.Left="110" Canvas.Top="125"
                               Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Point1]}" Foreground="White" FontSize="12"/>
                    <TextBlock x:Name="CorrectionLabel1" 
                               Canvas.Left="510" Canvas.Top="125"
                               Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Point2]}" Foreground="White" FontSize="12"/>
                    <TextBlock x:Name="CorrectionLabel2" 
                               Canvas.Left="510" Canvas.Top="325"
                               Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Point3]}" Foreground="White" FontSize="12"/>
                    <TextBlock x:Name="CorrectionLabel3" 
                               Canvas.Left="110" Canvas.Top="325"
                               Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Point4]}" Foreground="White" FontSize="12"/>
                </Canvas>

                <!-- 校正控制按钮 -->
                <StackPanel Orientation="Horizontal" 
                            HorizontalAlignment="Center" 
                            VerticalAlignment="Bottom"
                            Margin="0,0,0,20">
                    <Button Style="{DynamicResource ButtonStyle}" x:Name="ApplyCorrectionButton" 
                            Content="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Complete]}" 
                            Click="ApplyCorrectionButton_Click"
                            Margin="5" Width="80" Height="40"/>
                    <Button Style="{DynamicResource ButtonStyle}" x:Name="ResetCorrectionButton" 
                            Content="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Reset]}" 
                            Click="ResetCorrectionButton_Click"
                            Margin="5" Width="80" Height="40"/>
                    <Button Style="{DynamicResource ButtonStyle}" x:Name="CancelCorrectionButton" 
                            Content="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[Cancel]}" 
                            Click="CancelCorrectionButton_Click"
                            Margin="5" Width="80" Height="40"/>
                </StackPanel>

                <TextBlock Text="{Binding Source={x:Static services:LanguageManager.Instance}, Path=Translations[CorrectionHint]}" 
                           Foreground="White" FontSize="14"
                           HorizontalAlignment="Center" 
                           VerticalAlignment="Top"
                           Margin="0,20,0,0"/>
            </Grid>
        </Grid>
    </Grid>
</Window>